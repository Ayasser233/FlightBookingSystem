@using Newtonsoft.Json
@model PaymentDto

<h2>Flight Details</h2>
<p>Flight ID: @Model.Flight.FlightId</p>
<p>Total Price: @Model.TotalPrice</p>

<h2>Passenger Information</h2>
<ul>
    @foreach (var passenger in Model.Passengers)
    {
        <li>@passenger.FullName, Passport: @passenger.PassportNumber</li>
    }
</ul>

<form asp-action="Step4" method="post">
    <div>
        <label asp-for="CardNumber">Card Number</label>
        <input asp-for="CardNumber" />
        <span asp-validation-for="CardNumber"></span>
    </div>
    <div>
        <label asp-for="ExpiryDate">Expiry Date</label>
        <input asp-for="ExpiryDate" type="date" min="@DateTime.Now.ToString("yyyy-MM")" />
        <span asp-validation-for="ExpiryDate"></span>
    </div>
    <div>
        <label asp-for="PaymentMethod">Payment Method</label>
        <select asp-for="PaymentMethod">
            <option value="CreditCard">Credit Card</option>
            <option value="PayPal">PayPal</option>
        </select>
    </div>

    <h4>Passengers</h4>
    <ul>
        @foreach (var passenger in Model.Passengers)
        {
            <li>@passenger.FullName - @passenger.PassportNumber</li>
        }
    </ul>

    <!-- Serialize the Flight object and Passengers list as hidden inputs -->
    <input type="hidden" asp-for="@Model.Flight" name="Flight" value='@JsonConvert.SerializeObject(Model.Flight)' />
    <input type="hidden" asp-for="@Model.Passengers" name="Passengers" value='@JsonConvert.SerializeObject(Model.Passengers)' />

    <button type="submit">Complete Payment</button>
</form>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
